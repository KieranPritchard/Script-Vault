import subprocess

# Function which brings in the results data from another script
def import_results_data(path):
    # Opens the file with read
    with open(path, "r") as f:
        # Brings in the data as a list
        data = f.readlines()
    # Returns the data
    return data

# Function to filter out any results which flag a false positive
def filter_results(data):
    # Stores the verified urls
    verified_urls = []
    
    # Loops over the urls in the data
    for url in data:
        # Outputs the url being verifyed
        print(f"Verifying: {url}")
        
        # Runs sqlmap with --batch to skip prompts
        result = subprocess.run([
            "sqlmap", "-u", url, 
            "--batch", 
            "--leval=1", # Keep it fast for verification
            "--flush-session" # Ignore previous results for a clean test
        ], capture_output=True, text=True)

        # Checks the standard output for is vulnerable
        if "is vulnerable" in result.stdout:
            # Outputs the url is confirmed as vulnerable
            print(f"[+] Confirmed: {url}")
            # Adds the url to the verified urls
            verified_urls.append(url)
        else:
            # Ouputs the url was a false positive
            print(f"[-] False Positive: {url}")
    # Returns verified urls
    return verified_urls